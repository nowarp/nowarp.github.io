"use strict";(self.webpackChunknowarp_github_io=self.webpackChunknowarp_github_io||[]).push([[2997],{284:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var i=n(4848),o=n(8453);const r={},s="Writing Custom Detectors",c={id:"hacking/custom-detector",title:"Writing Custom Detectors",description:"Introduction",source:"@site/versioned_docs/version-0.9/hacking/custom-detector.md",sourceDirName:"hacking",slug:"/hacking/custom-detector",permalink:"/tools/misti/docs/hacking/custom-detector",draft:!1,unlisted:!1,editUrl:"https://github.com/nowarp/nowarp.github.io/tree/master/versioned_docs/version-0.9/hacking/custom-detector.md",tags:[],version:"0.9",frontMatter:{},sidebar:"sidebar",previous:{title:"Developing Misti",permalink:"/tools/misti/docs/hacking/developing-misti"},next:{title:"Custom Tools",permalink:"/tools/misti/docs/hacking/custom-tool"}},a={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Creating a Detector",id:"creating-a-detector",level:2},{value:"Example implementation",id:"example-implementation",level:3},{value:"Running detector",id:"running-detector",level:3},{value:"Saving the configuration",id:"saving-the-configuration",level:3},{value:"Example Detectors",id:"example-detectors",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"writing-custom-detectors",children:"Writing Custom Detectors"}),"\n",(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(t.p,{children:["Misti provides an API to write custom ",(0,i.jsx)(t.a,{href:"/tools/misti/docs/detectors",children:"detectors"}),", allowing you to implement your own linting rules. These custom detectors enable you to identify specific issues in your codebase, much like other static analysis tools. The API reference can be found here: ",(0,i.jsx)(t.a,{href:"https://nowarp.io/api/misti/",children:"Misti API Reference"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Detectors are designed to be dynamically loaded by the Misti driver, and they are present by TypeScript classes that implement the ",(0,i.jsx)(t.a,{href:"https://nowarp.io/api/misti/classes/detectors_detector.Detector.html",children:(0,i.jsx)(t.code,{children:"Detector"})})," interface."]}),"\n",(0,i.jsx)(t.h2,{id:"creating-a-detector",children:"Creating a Detector"}),"\n",(0,i.jsx)(t.h3,{id:"example-implementation",children:"Example implementation"}),"\n",(0,i.jsxs)(t.p,{children:["You can find example of custom detectors in ",(0,i.jsxs)(t.a,{href:"https://github.com/nowarp/misti/tree/master/examples",children:["the ",(0,i.jsx)(t.code,{children:"examples"})," directory"]}),", which contains the template code for writing your own custom detector logic leveraging the Misti API."]}),"\n",(0,i.jsxs)(t.p,{children:["Here's an example of how to implement a custom detector using Misti API (",(0,i.jsx)(t.a,{href:"https://github.com/nowarp/misti/tree/master/examples/implicit-init",children:"source code"}),"):"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:'import { AstDetector } from "@nowarp/misti/dist/detectors/detector";\nimport { CompilationUnit, FunctionName } from "@nowarp/misti/dist/internals/ir";\nimport {\n  Warning,\n  Severity,\n} from "@nowarp/misti/dist/internals/warnings";\n\n/**\n * An example of a custom detector that showcases the usage of the detector API.\n *\n * It reports all the contracts that doesn\'t have an explicit implementation of the init function.\n */\nexport class ImplicitInit extends AstDetector {\n  severity = Severity.INFO;\n\n  async check(cu: CompilationUnit): Promise<Warning[]> {\n    return Array.from(cu.getContracts()).reduce(\n      (foundErrors, [_, contract]) => {\n        if (!cu.findMethodCFGByName(contract.name, "init" as FunctionName)) {\n          const err = this.makeWarning(\n            `Contract ${contract.name} doesn\'t define an init function`,\n            contract.loc,\n          );\n          foundErrors.push(err);\n        }\n        return foundErrors;\n      },\n      [] as Warning[],\n    );\n  }\n}\n'})}),"\n",(0,i.jsx)(t.h3,{id:"running-detector",children:"Running detector"}),"\n",(0,i.jsxs)(t.p,{children:["To run Misti with only your new detector, use the ",(0,i.jsx)(t.code,{children:"--enabled-detectors"})," (",(0,i.jsx)(t.code,{children:"-de"}),") option, specifying the path to the detector and the Detector class name:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"misti path/to/src/contracts -de path/to/implicitInit.ts:ImplicitInit\n"})}),"\n",(0,i.jsxs)(t.p,{children:["That's a good way to test the detector on the first run. You could also use the ",(0,i.jsx)(t.code,{children:"--verbose"})," CLI option and set the environment variable ",(0,i.jsx)(t.code,{children:"MISTI_TRACE=1"})," to facilitate debugging."]}),"\n",(0,i.jsx)(t.h3,{id:"saving-the-configuration",children:"Saving the configuration"}),"\n",(0,i.jsx)(t.p,{children:"After testing the detector, you can specify it in your configuration to enable it in future runs. Update your Misti configuration file to include the path to your custom detector implementation, e.g.:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{\n  "detectors": [\n    // Other detectors...\n    { "className": "ImplicitInit", "modulePath": "ImplicitInit.ts" }\n  ],\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"After this, you could run Misti specifying a path to a custom configuration which is less verbose when you have a few custom detectors:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"misti --config path/to/misti.config.json path/src/contracts\n"})}),"\n",(0,i.jsx)(t.h2,{id:"example-detectors",children:"Example Detectors"}),"\n",(0,i.jsxs)(t.p,{children:["The best way to examine how to use the Misti API is to look at the example detectors. Navigate to the ",(0,i.jsx)(t.a,{href:"https://github.com/nowarp/misti/tree/master/examples",children:"examples directory"})," in the Misti repository to see how various detectors are implemented. Additionally, the built-in detectors are present in the project and are well-documented, providing further insight into writing effective custom detectors."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>c});var i=n(6540);const o={},r=i.createContext(o);function s(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);